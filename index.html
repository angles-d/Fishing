
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name = "viewport" content ="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>FISHING</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  </head>
  <body>
    <button onclick = "activateXR()">start</button>
    <script>
      async function activateXR() {
        const canvas = document.createElement("canvas");
        document.body.appendChild(canvas);
        const gl = canvas.getContext("webgl", {xrCompatible: true});

        const scene = new THREE.Scene();
        const materials = [
          new THREE.MeshBasicMaterial({color:0xfcba03}),
          new THREE.MeshBasicMaterial({color:0x4efc03}),
          new THREE.MeshBasicMaterial({color:0x03ebfc}),
          new THREE.MeshBasicMaterial({color:0x03ebfc}),
          new THREE.MeshBasicMaterial({color:0x1803fc}),
          new THREE.MeshBasicMaterial({color:0xfc03eb})
        ];
        const cube = new THREE.Mesh(new THREE.BoxBufferGeometry(0.2,0.2,0.2), materials);
        cube.position.set(1,1,1);
        scene.add(cube);

        const renderer = new THREE.WebGLRenderer({
          alpha: true,
          preserveDrawingBuffer: true,
          canvas: canvas,
          context:gl
        });
        renderer.autoClear = false;
        
        const camera = new THREE.PerspectiveCamera();
        camera.matrixAutoUpdate = false;

        const session = await navigator.xr.requestSession("immersive-ar");
        session.updateRenderState({
          baseLayer: new XRWebGLLayer(session, gl)
        });
        const referenceSpace= await session.requestReferenceSpace('local');
        const onXRFrame = (time, frame) => {
          session.requestAnimationFrame(onXRFRame);
          gl.bindFramebuffer(gl.FRAMEBUFFER, session.renderState.baseLayer.framebuffer)
          const pose = frae.getViewerPose(referenceSpace);
          if (pose){
            const view  = pose.views[0];
            const viewport = session.renderState.baseLayer.getViewport(view);
            renderer.setSize(viewport.width, viewport.height);

            camera.matrix.fromArray(view.transform.matrix);
            camera.projectionMatrix.fromArray(view.projectionMatrix);
            camera.updateMatrixWorld(true);

            renderer.render(scene, canera);

          }
        }

        session.requestAnimationFrame(onXRFrame);

      }
    </script>

    <!-- <a-scene>
      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene> -->
  </body>
</html>